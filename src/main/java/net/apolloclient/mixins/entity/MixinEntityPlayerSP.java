/*⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼
  Copyright (C) 2020-2021 developed by Icovid and Apollo Development Team
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see https://www.gnu.org/licenses/.
  
  Contact: Icovid#3888 @ https://discord.com
 ⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼⎼*/

package net.apolloclient.mixins.entity;

import net.apolloclient.event.impl.player.PlayerChatEvent;
import net.minecraft.client.Minecraft;
import net.minecraft.client.entity.EntityPlayerSP;
import net.minecraft.client.network.NetHandlerPlayClient;
import net.minecraft.network.play.client.C01PacketChatMessage;
import org.spongepowered.asm.mixin.Final;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.Overwrite;
import org.spongepowered.asm.mixin.Shadow;

/**
 * {@link Mixin} target injections for events derived from {@link EntityPlayerSP}.class
 *
 * @author Nora Cos | Nora#0001
 * @see EntityPlayerSP target
 * @since 1.2.0-BETA
 */
@Mixin(EntityPlayerSP.class)
public class MixinEntityPlayerSP {

    /** {@link NetHandlerPlayClient} que to send messages to server */
    @Shadow @Final public NetHandlerPlayClient sendQueue;

    /**
     * Posts a new {@link PlayerChatEvent} when {@link Minecraft#thePlayer} attempts to send
     * a chat message
     *
     * @param message message player sent
     *
     * @author Nora Cos | Nora#0001
     * @see EntityPlayerSP#sendChatMessage(String) target
     */
    @Overwrite
    public void sendChatMessage(String message) {
        if (message == null) return;
        PlayerChatEvent event = new PlayerChatEvent(message);
        event.post();
        if (!event.isCanceled()) this.sendQueue.addToSendQueue(new C01PacketChatMessage(event.message));
    }
}
